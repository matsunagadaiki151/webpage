---
layout: post
tag: [ 岐大祭2018 , Unity ]
---

この記事は、岐大祭に向けてアドベントカレンダー的な記事を書く企画の 6 日目です。
私は、音声認識を使ってキャラクターを動かすゲームを作ったので主に音声認識について書いていこうと思います。多分、他の記事よりかは初心者向けかと思われます。

# 概要

このゲームはUnityで制作した、Android用のゲームです。キリンのキャラクター「ジラ太朗」に音声で命令してゴールまで導くゲームです。例えば「すすめ」と言ったら進むし、「ジャンプ」と言ったらジャンプします。ムーンサルトさせたり、マシンガンを放ったりすることもできます。いろいろとはっちゃけてます。
//[ゲーム画面](game.png)



# 音声認識について

では、音声認識の方法について書いていこうと思います。まず、一般的なAndroidアプリ開発ではAPIを使うことで、簡単に音声認識をすることができます。代表的なAPIとして「[Speech Recognizer](https://developer.android.com/reference/android/speech/SpeechRecognizer)」というものがあり、このゲームでもこれを使っています。しかし、Unityではこれだけでは音声認識はできません。一般的なAndroidあるプリ開発が、javaで行われるのに対し、UnityはC#であるためです。そこでUnityには[ネイティブプラグイン](https://docs.unity3d.com/ja/current/Manual/Plugins.html)という機能があります。ネイティブプラグインを使うと「システムコールやサードパティのコードライブラリなどといった、元々 Unity で使用できない機能にアクセスすることができます」([Unityマニュアル](https://docs.unity3d.com/ja/current/Manual/Plugins.html)
より引用)。これを利用してSpeech RecognizerをUnityに適用します。
ネイティブプラグインの流れの一例は以下のようです。

1. eclipse, Android Studio などでjavaコードを書く。
2. aarファイル, xmlファイルを作成
3. Unityにaar,xmlをおく
4. C#コードを書いてプラグインを適用

...なんでこんな大雑把なのかといいますと、実際はこんなことやってないんです。というのもすでにこのようなことをやっている方がいまして、プラグインのサンプルがネットに公開されていたためです。これをお借りして自分なりにアレンジして使用しました。お借りしたものは[こちら](http://fantom1x.blog130.fc2.com/blog-entry-273.html?sp)で公開されています。そのため私から音声認識の実装方法に関してこれ以上言えることはありません。ただ、Unityは人口が多く、自分がやろうと思っていることをすでにやっている人がいて、やり方やサンプルが公開されているということはよくあることだと思います。なので、まず何か公開されているものを探すのも一つの手だと思います。

# 言語処理について

音声認識APIを利用すれば、ある程度の言語は認識できるようになります。しかし、発音が似ている単語や、辞書に登録されてない造語などは、誤認識されてしまう可能性があります。APIそのものを操作することはできないため、そのような単語を認識させるためには、言語処理をする必要があります。一番簡単なやり方として、誤認識された文字を本来認識されたい文字に変換させる。やり方があります。

例　:「攻撃」という単語を認識させたいが、「法的」という単語が認識されてしまうとき

```C# : attack.cs
if (text == "法的") //法的という単語の時
{
  text = "攻撃"; //攻撃という単語にする
}
```

ただ、このやり方だと長い造語などで何パターンもの誤認識が発生してしまう場合、有効とは言えません。そういった場合、文字の他の特徴を見つけてそれと組み合わせてやれば良いです。文字の特徴の一例として文字列の長さがあります。

例 : 「スピーチレコグナイザー」と認識させたいが、「スピーチで国内ザー」、「スピーチでここのユーザー」、「スピーチで国内画像」などと誤認識されてしまう場合。

```C# : Recognizer.cs
if (text.Contains("スピーチ") && text.Length >= 9) //スピーチという単語が含まれていて、かつ9文字以上のとき
{
  text = "スピーチレコグナイザー"; //スピーチレコグナイザーという単語にする
}
```
上の例では、特定の文字列があるかどうかを探索し、さらに文字列の大きさを調べています。

以上が人間の手で短時間で行う言語処理の方法です。言語処理については次回の記事でより詳しくしることができます。

